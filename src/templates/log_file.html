{% extends "base.html" %}
{% block title %}{{ vehicle['unit_number'] }} {{ log['start_time'] }} - LogServer{% endblock %}

{% block content %}
    <h1>Log File: {{ "%05d" % log['log_number'] }}</h1>
            {% if log['headline'] %}
                <h2>{{ log['headline'] }}</h2>  
            {% endif %}
    <a href="{{ url_for('specific_unit', vehicle_type=vehicle['vehicle_type'], unit_id=vehicle['unit_number']) }}">
        <h4> {{ vehicle['vehicle_type'] }} - {{ vehicle['unit_number'] }}</h4>
    </a>
    <div style="display: flex; gap: 40px;">
        <div>
            <p>
                <H4>Log Status: {{ log['processing_status'] }} </H4><br>
                Original File Name: {{ log['original_file_name'] }} <br>
                Base File Name: {{ log['file_stem'] }} <br>
                Start time: {{ log['log_start_time'] }} <br>
                Upload time: {{ log['upload_time'] }} <br>
                {% if log['processing_status'] == "Processing Complete" %}
                    End time: {{ log['log_end_time'] }} <br>
                    {% if log['length_sec'] is not none %}
                        Length: {{ "%02d" % (log['length_sec'] // 3600) }}:{{ "%02d" % ((log['length_sec'] % 3600) // 60) }}:{{ "%02d" % (log['length_sec'] % 60) }} (HH:MM:SS)<br>
                    {% endif %}
                    {% if log['samples'] is not none %}
                        CAN Frames: {{ "{:,}".format(log['samples']) }} <br>
                    {% endif %}
                {% endif %}
            </p>
        </div>
        <div>
            <h4>File Status</h4>
            <ul>
                <li>
                    <b>Regular MF4 Log (Physical Values): </b>
                    {% if files_exist.regular_log %}
                        <span style="color: green;">Exists</span>
                        <a href="{{ url_for('download_log', uuid=log['id']) }}">Download</a> <br>
                    {% else %}
                        <span style="color: red;">Missing</span>
                    {% endif %}
                </li>
                <li>
                    Raw MF4 Log (CAN Frames): 
                    {% if files_exist.raw_logs %}
                        <span style="color: green;">Exists</span>
                        <a href="{{ url_for('download_raw_log', uuid=log['id']) }}">Download</a>
                    {% else %}
                        <span style="color: red;">Missing</span>
                    {% endif %}
                </li>
                <li>
                    Input Text Log: 
                    {% if files_exist.input_log_raw %}
                        <span style="color: green;">Exists</span>
                        <a href="{{ url_for('download_input_log', uuid=log['id']) }}">Download</a>
                    {% else %}
                        <span style="color: red;">Missing</span>
                    {% endif %}
                </li>
            </ul>
        </div>
    </div>
    <hr>

    <H4>Comments for this log</H4>
    {% for comment in comments %}
        <p>Comment: {{ comment['comment'] }} at time: {{comment['timestamp']}} 
            
            <form  method="post" >
                <input type="hidden" name="comment_id" value="{{comment['id']}}" />
                <input type="submit" name='submit_button' value="Delete Comment" />
            </form>
            </p>
        <hr>
    {% endfor %}

    <hr>
    <h4>Update Headline</h4>
    
    <form action="{{ url_for('update_log_headline', uuid=log['id'], unit_id=log['unit_number']) }}" method="post">
        <label for="headline">Headline:</label>
        <input type="text" id="headline" name="headline" placeholder="headline For Log"
               value="{{ log['headline'] if log['headline'] }}">
        <input type="submit" name='submit_button' value="Submit Headline">
    </form>

    <hr>
    <h4>Insert New Comment</h4>
    
    <form action="{{ url_for('get_log', uuid=log['id']) }}" method="post">
    <label for="comment">Comment:</label>
    <input type="text" id="comment" name="comment" placeholder="Comment About Log">
    <label for="timestamp">Timestamp:</label>
    <input type="number" id="timestamp" name="timestamp" value=0 >
    <input type="submit" name='submit_button' value="Submit Comment"></button>
    </form>
    
    <hr>
    <!-- Hide or show this log from the main list; viewable via "show hidden logs" link. -->
    {% if log['hide_in_web'] %}
        <p>This log file is currently hidden. You can make it visible again.</p>
        <form action="{{ url_for('show_log', uuid=log['id']) }}" method="post">
            <input type="submit" name='submit_button' value="Show Log">
        </form>
    {% else %}
        <p>Hide this log file from the list. Viewable via "show hidden logs"</p>
        <form action="{{ url_for('hide_log', uuid=log['id']) }}" method="post">
            <input type="submit" name='submit_button' value="Hide Log">
        </form>
    {% endif %}
    
{% endblock %}